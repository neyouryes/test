<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="color-scheme" content="light dark">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ne, Coffee Fitting Test â€” Cathub Ready (Full)</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{ --ink:#3B2A22; --ink-2:#5A4034; --accent:#6A4B3B; --surface:rgba(255,255,255,.92); --border:#E7DED6; --bg:#f7f2ef }
@media (prefers-color-scheme: dark){ :root{ --surface:rgba(28,24,22,.82); --border:#433a34; --ink:#faefe9; --ink-2:#d8c6bc; --bg:#151210 } .opt label{ background:#1c1715 } .pair{background:#2a221e;border-color:#5a4034;color:#faefe9} .bean{ background:#1a1715 } .banner img{ opacity:.75 } } .bean{border:1px solid var(--border);border-radius:14px;padding:14px 12px;background:#fefcfa;text-align:center;box-shadow:0 2px 10px rgba(59,42,34,.06)} .banner img{ opacity:.75 } }
*{box-sizing:border-box}
html,body{height:100%}
body{ font-family:'Noto Serif KR', serif; color:var(--ink); line-height:1.7; letter-spacing:.1px; background:var(--bg); margin:0; font-size:16px }
.wrap{max-width:860px;margin:0 auto;padding:0 16px 72px}
.dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:6px;vertical-align:-1px}
/* ë°°ë„ˆ */
.banner{position:relative;margin:0 -16px 12px;aspect-ratio:16/5;border-radius:16px;overflow:hidden;background:#000}
.banner img{width:100%;height:100%;object-fit:cover;display:block;opacity:.82;transition:opacity .4s ease}
.banner-text{position:absolute;bottom:14px;left:16px;display:flex;flex-direction:column;gap:2px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.35)}
.banner-top{font-weight:700;font-size:1.6rem;line-height:1.2}
.banner-bottom{font-size:0.9rem;opacity:.9}
/* ì¹´ë“œ */
.card{background:var(--surface);border-radius:16px;box-shadow:0 10px 30px rgba(59,42,34,.18);padding:18px;margin-top:10px;border:1px solid var(--border);backdrop-filter:saturate(150%) blur(6px)}
.title{margin:6px 0 4px;font-size:1.38rem;font-weight:700}
.desc{margin:0 0 12px;color:var(--ink-2);font-size:1rem;line-height:1.9;letter-spacing:.1px}
.desc .desc-line{display:inline}
/* ë¬¸í•­ */
.q{padding:12px 0;border-top:1px dashed var(--border)}
.q:first-child{border-top:0}
.q-title{font-size:1.05rem;margin:4px 0 8px;font-weight:700}
.opts{display:grid;gap:8px}
.opt{position:relative}
.opt input{position:absolute;opacity:0;pointer-events:none}
.opt label{ display:block;background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:10px 12px;cursor:pointer; transition:box-shadow .15s ease,border-color .15s ease,transform .05s ease }
.opt label:active{transform:scale(.995)}
.opt input:checked + label{border-color:var(--accent);box-shadow:0 0 0 2px rgba(106,75,59,.15) inset;background:var(--accent);color:#fff;transition:all .15s ease}
/* MBTI (Q1) */
.mbti-rows{display:grid;gap:12px}
.mbti-row{display:grid;grid-template-columns:1fr;gap:12px}
.pair{display:grid;grid-template-columns:1fr 1fr;gap:8px;border:1px dashed var(--border);border-radius:10px;padding:10px;background:#fff}
.pair-legend{ grid-column:1/-1;font-size:.85rem;color:var(--ink-2); margin:0 0 6px;text-align:center;white-space:nowrap }
@media(min-width:560px){.mbti-row{grid-template-columns:1fr 1fr}}
/* Q3: ìƒ‰ìƒ (ê·¸ë¼ë°ì´ì…˜ ë°”) */
.gradient-bar{ position:relative; height:40px; border-radius:10px; overflow:hidden; display:flex; margin-top:10px; background:none; isolation:isolate }
.gradient-bar::before{ content:""; position:absolute; inset:0; border-radius:10px; background-image:url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 40' preserveAspectRatio='none'>\
<defs><linearGradient id='g' x1='0' x2='1'>\
<stop offset='0%' stop-color='%23F7D794'/>\
<stop offset='14.3%' stop-color='%23F6C89F'/>\
<stop offset='28.6%' stop-color='%23D9A441'/>\
<stop offset='42.9%' stop-color='%23E7798E'/>\
<stop offset='57.2%' stop-color='%23C96E6E'/>\
<stop offset='71.5%' stop-color='%238E3A59'/>\
<stop offset='85.8%' stop-color='%238C6A43'/>\
<stop offset='100%' stop-color='%235A3E36'/>\
</linearGradient></defs>\
<rect width='800' height='40' fill='url(%23g)'/>\
</svg>"); background-size:100% 100%; background-repeat:no-repeat; pointer-events:none; mix-blend-mode:normal; filter:none !important; forced-color-adjust:none }
.gradient-bar label{flex:1;cursor:pointer;position:relative;z-index:1}
.gradient-bar input{display:none}
.gradient-bar span{display:block;width:100%;height:100%}
.gradient-bar input:checked + span{ outline:3px solid var(--accent); outline-offset:-3px; border-radius:4px }
/* ì œì¶œ ë°” */
.submitbar{position:sticky;bottom:0;margin-top:12px;z-index:20}
.submitcard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:10px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 24px rgba(59,42,34,.18)}
.progress{flex:1;height:8px;background:#efe6de;border-radius:999px;overflow:hidden}
.progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#3b2a22);transition:width .3s ease}
/* ë²„íŠ¼ */
.btn{appearance:none;-webkit-appearance:none;border:0;border-radius:12px;padding:10px 14px;font-size:.95rem;cursor:pointer;color:#fff;background:linear-gradient(180deg,#3b2a22,#2c1f19);background-clip:padding-box;transition:filter .15s ease,transform .05s ease}
.btn:hover{filter:brightness(1.05)}
.btn:active{transform:scale(.995)}
.btn:focus-visible{outline:2px solid #b38a72;outline-offset:2px}
.btn[disabled]{opacity:.55;cursor:not-allowed;filter:none!important}
/* ê²°ê³¼ ëª¨ë‹¬ */
.result{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
.result.show{display:flex}
.result-card{max-width:760px;width:100%;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.28), 0 2px 10px rgba(0,0,0,.08);overflow:hidden;position:relative;background-image:radial-gradient(1200px 400px at 50% -20%, rgba(106,75,59,.08), transparent 60%)}
.result-card::before{content:"";position:absolute;inset:0;border-radius:20px;padding:1px;background:linear-gradient(135deg, rgba(106,75,59,.35), rgba(59,42,34,.12));-webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);-webkit-mask-composite:destination-out;mask-composite:exclude;pointer-events:none;z-index:0}
.result-card::after{content:"Ne, Coffee";position:absolute;right:16px;bottom:12px;font-size:.72rem;letter-spacing:.08em;color:rgba(59,42,34,.55)}
@media (prefers-color-scheme: dark){ .result-card{ background:#1c1714;color:#efe4dd;box-shadow:0 24px 80px rgba(0,0,0,.55),0 2px 10px rgba(0,0,0,.25) } .result-card::before{background:linear-gradient(135deg, rgba(179,138,114,.45), rgba(106,75,59,.15))} .result-card::after{color:rgba(234,224,218,.45)} }
.result-body{padding:22px 18px 22px;color:#2a1d18;max-width:640px;margin:0 auto;position:relative;z-index:1}
.result-title{font-size:1.5rem;margin:4px 0 6px;font-weight:800;text-align:center}
.combo-title{font-size:0.9rem;color:#6a4b3b;margin:0 0 10px;font-weight:500;text-align:center;line-height:1.9}
.theme-line{font-size:.96rem;color:var(--ink-2);text-align:center;margin:8px 0 6px}
.emoji-line{text-align:center;font-size:1.4rem;margin:14px 0;position:relative}
.emoji-line::before,.emoji-line::after{content:"";position:absolute;top:50%;width:32%;height:1px;background:linear-gradient(90deg,transparent, rgba(106,75,59,.35));}
.emoji-line::before{left:0}
.emoji-line::after{right:0;transform:scaleX(-1)}
/* ì›ë‘ ì¹´ë“œ */
.bean-cards{display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px}
@media(min-width:480px){.bean-cards{grid-template-columns:1fr 1fr}}
.bean{ border:1px solid var(--border);border-radius:14px;padding:12px;background:#fefcfa;text-align:center }
.bean-title-en{font-weight:800;font-size:1.02rem;margin:0}
.bean-title-ko{font-size:0.9rem;color:var(--ink-2);margin:2px 0 0}
.bean-note{font-size:0.9rem;margin:6px 0 0}
/* ë°©ì‹ ë¬¸êµ¬ */
.method-text{margin-top:14px;font-size:0.9rem;font-weight:400;color:#3b2a22;text-align:center;line-height:1.9}
/* ê²°ê³¼ ì•¡ì…˜ */
.actions-line{margin-top:14px;text-align:center;color:var(--ink-2);user-select:none}
.actions-line a{color:var(--accent);text-decoration:none;padding:0 8px;cursor:pointer;font-size:.98rem}
.actions-line a:hover,.actions-line a:focus{text-decoration:underline;outline:none}
/* í† ìŠ¤íŠ¸ */
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);padding:10px 14px;background:#000;color:#fff;border-radius:10px;opacity:0;transition:opacity .2s ease, transform .2s ease;pointer-events:none}
.toast.show{opacity:1;transform:translate(-50%,0)}
/* ëª¨ë°”ì¼ í„°ì¹˜ í”¼ë“œë°± & íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
button,a,input,label,select,textarea{ -webkit-tap-highlight-color:transparent; outline:none; transition:filter .15s ease, transform .1s ease }
button:active,a:active,input:active,label:active,select:active,textarea:active{ filter:brightness(.92); transform:scale(.98) }
/* ë‹¤í¬ëª¨ë“œ ë²„íŠ¼ & ì§„í–‰ë°” ê°œì„  */
@media (prefers-color-scheme: dark){
  .btn{ color:#fff; background:linear-gradient(180deg,#463229,#241914); -webkit-tap-highlight-color:transparent; transition:background .15s ease, transform .05s ease, filter .15s ease }
  .btn:hover{ filter:brightness(1.08); transform:translateY(-1px) }
  .btn:active{ background:linear-gradient(180deg,#3b2a22,#1b130f); transform:scale(.985); filter:brightness(.95) }
  .btn[disabled]{ opacity:.55; cursor:not-allowed; filter:none!important; transform:none!important }
  .submitcard{ background:var(--surface); transition:background .25s ease }
  .progress{ background:#2a221e }
  .progress>span{ background:linear-gradient(90deg,#b38a72,#e0c3ad) }
}
/* Dark-mode contrast fixes */
@media (prefers-color-scheme: dark){
  .result-card{ background:#1c1714; color:#efe4dd }
  .result-body{ position:relative; z-index:1 }
  .result-title{ color:#f6ece5 }
  .combo-title{ color:#e9d7cc }
  .theme-line{ color:#e0cfc5 }
  .method-text{ color:#f0e6df }
  .actions-line{ color:#cdb8ad }
  .actions-line a{ color:#e7c5ad }
}
  @media (prefers-color-scheme: dark){
  .result-title{color:#f6ece5 !important}
  .combo-title{color:#e9d7cc !important}
  #theme-line{color:#e0cfc5 !important}
  #method-text{color:#f0e6df !important}
  .actions-line{color:#cdb8ad !important}
  .actions-line a{color:#e7c5ad !important}
}

</style>
</head>
<body>
<div class="wrap">
  <div class="banner" aria-hidden="true">
    <img id="bannerImg" src="banner1.jpg" alt="">
    <div class="banner-text">
      <div class="banner-top">Ne, Coffee Fitting Test</div>
      <div class="banner-bottom">ë„¤,ì»¤í”¼ í•íŒ… í…ŒìŠ¤íŠ¸</div>
    </div>
  </div>

  <div class="card" aria-describedby="progressText">
    <h1 class="title">ë„¤,ì»¤í”¼ í•íŒ… í…ŒìŠ¤íŠ¸</h1>
    <p class="desc"><span class="desc-line">5ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•˜ê³ ,</span><br><span class="desc-line">ë‹¹ì‹ ì—ê²Œ ë”±ë§ëŠ” ì›ë‘ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”.</span></p>

    <form id="quiz">
      <!-- Q1. MBTI -->
      <section class="q" aria-labelledby="q1-label">
        <h2 id="q1-label" class="q-title">Q1. ë‚˜ì˜ MBTIëŠ”?</h2>
        <div class="mbti-rows">
          <div class="mbti-row">
            <fieldset class="pair" role="radiogroup" aria-label="ì™¸í–¥/ë‚´í–¥">
              <legend class="pair-legend">E / I</legend>
              <div class="opt"><input id="ei-e" type="radio" name="mbti-ei" value="E"><label for="ei-e">E (ì™¸í–¥)</label></div>
              <div class="opt"><input id="ei-i" type="radio" name="mbti-ei" value="I"><label for="ei-i">I (ë‚´í–¥)</label></div>
            </fieldset>
            <fieldset class="pair" role="radiogroup" aria-label="ì§ê´€/ê°ê°">
              <legend class="pair-legend">N / S</legend>
              <div class="opt"><input id="ns-n" type="radio" name="mbti-ns" value="N"><label for="ns-n">N (ì§ê´€)</label></div>
              <div class="opt"><input id="ns-s" type="radio" name="mbti-ns" value="S"><label for="ns-s">S (ê°ê°)</label></div>
            </fieldset>
          </div>
          <div class="mbti-row">
            <fieldset class="pair" role="radiogroup" aria-label="ê°ì •/ì‚¬ê³ ">
              <legend class="pair-legend">F / T</legend>
              <div class="opt"><input id="ft-f" type="radio" name="mbti-ft" value="F"><label for="ft-f">F (ê°ì •)</label></div>
              <div class="opt"><input id="ft-t" type="radio" name="mbti-ft" value="T"><label for="ft-t">T (ì‚¬ê³ )</label></div>
            </fieldset>
            <fieldset class="pair" role="radiogroup" aria-label="ê³„íš/ì¸ì‹">
              <legend class="pair-legend">J / P</legend>
              <div class="opt"><input id="jp-j" type="radio" name="mbti-jp" value="J"><label for="jp-j">J (ê³„íš)</label></div>
              <div class="opt"><input id="jp-p" type="radio" name="mbti-jp" value="P"><label for="jp-p">P (ì¸ì‹)</label></div>
            </fieldset>
          </div>
        </div>
      </section>

      <!-- Q2. í–¥ë¯¸ -->
      <section class="q" aria-labelledby="q2-label">
        <h2 id="q2-label" class="q-title">Q2. ë‚´ê°€ ëŒë¦¬ëŠ” ì»¤í”¼ì˜ í–¥ë¯¸ëŠ”?</h2>
        <div class="opts">
          <div class="opt"><input id="q2-1" type="radio" name="q2" value="AG"><label for="q2-1">ë¬µì§í•˜ê³  ì§„í•œ ë¡œìŠ¤í‹°ë“œ í’ë¯¸</label></div>
          <div class="opt"><input id="q2-2" type="radio" name="q2" value="BH"><label for="q2-2">ê³ ì†Œí•˜ê³  ë”°ëœ»í•œ ë‹¬ì½¤í•¨</label></div>
          <div class="opt"><input id="q2-3" type="radio" name="q2" value="CF"><label for="q2-3">ìƒí¼í•˜ê³  í™œë ¥ ë„˜ì¹˜ëŠ” ê³¼ì¼í–¥</label></div>
          <div class="opt"><input id="q2-4" type="radio" name="q2" value="DE"><label for="q2-4">ì„¬ì„¸í•˜ê³  íŠ¹ë³„í•œ ê½ƒ/ìŠ¤íŒŒì´ì‹œ í–¥</label></div>
        </div>
      </section>

      <!-- Q3. ìƒ‰ìƒ (ê·¸ë¼ë°ì´ì…˜ ë°”) -->
      <section class="q" aria-labelledby="q3-label">
        <h2 id="q3-label" class="q-title">Q3. ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ì»¤í”¼ì˜ ìƒ‰ê°ì€?</h2>
        <div class="gradient-bar" role="radiogroup" aria-labelledby="q3-label">
          <label><input type="radio" name="q3" value="E" aria-label="ë°ì€ ê¿€ë¹› ê³„ì—´"><span></span></label>
          <label><input type="radio" name="q3" value="C" aria-label="ì—°í•œ ì¹´ë¼ë©œí†¤"><span></span></label>
          <label><input type="radio" name="q3" value="A" aria-label="ì‚´êµ¬ë¹› ë¡œìŠ¤í‹°"><span></span></label>
          <label><input type="radio" name="q3" value="F" aria-label="ì›œ ë¡œì¦ˆí†¤"><span></span></label>
          <label><input type="radio" name="q3" value="D" aria-label="í•‘í¬ë¹› ë² ë¦¬í†¤"><span></span></label>
          <label><input type="radio" name="q3" value="B" aria-label="ë¼ì¼ë½ ì´ˆì½œë¦¿í†¤"><span></span></label>
          <label><input type="radio" name="q3" value="G" aria-label="ê³ ë™ ê³„ì—´"><span></span></label>
          <label><input type="radio" name="q3" value="H" aria-label="ë‹¤í¬ ì¹´ì¹´ì˜¤í†¤"><span></span></label>
        </div>
      </section>

      <!-- Q4. ê¸°ë¶„ -->
      <section class="q" aria-labelledby="q4-label">
        <h2 id="q4-label" class="q-title">Q4. ì§€ê¸ˆì˜ ë‚˜ì™€ ê°€ê¹Œìš´ ê¸°ë¶„ì€?</h2>
        <div class="opts">
          <div class="opt"><input id="q4-1" type="radio" name="q4" value="AD"><label for="q4-1">ê°•ë ¬í•œ ì§‘ì¤‘ê³¼ ì—ë„ˆì§€ê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-2" type="radio" name="q4" value="BG"><label for="q4-2">ì‚¬ë‘ê³¼ ìœ„ë¡œê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-3" type="radio" name="q4" value="CE"><label for="q4-3">ì°¨ë¶„í•œ íœ´ì‹ê³¼ ì—¬ìœ ê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-4" type="radio" name="q4" value="FH"><label for="q4-4">í™œë ¥ê³¼ ë‹¬ì½¤í•œ ê¸°ë¶„ ì „í™˜ì´ í•„ìš”í•´ìš”</label></div>
        </div>
      </section>

      <!-- Q5. ë°©ì‹ ì„±í–¥ -->
      <section class="q" aria-labelledby="q5-label">
        <h2 id="q5-label" class="q-title">Q5. ì»¤í”¼ë¥¼ ì¦ê¸¸ ë•Œ ë‚˜ëŠ”?</h2>
        <div class="opts">
          <div class="opt"><input id="m1" type="radio" name="method" value="M1"><label for="m1">ì§„í•˜ê³  ì˜¤ë˜ ê°€ëŠ” í˜ìœ¼ë¡œ ì§‘ì¤‘ì„ ì›í•´ìš”</label></div>
          <div class="opt"><input id="m2" type="radio" name="method" value="M2"><label for="m2">í–¥ë¯¸ë¥¼ ì„¬ì„¸í•˜ê²Œ ìŒë¯¸í•˜ê³  ì‹¶ì–´ìš”</label></div>
          <div class="opt"><input id="m3" type="radio" name="method" value="M3"><label for="m3">ë‹¬ì½¤í•˜ê³  ì‹œì›í•œ ì „í™˜ì´ í•„ìš”í•´ìš”</label></div>
        </div>
      </section>

      <div class="submitbar">
        <div class="submitcard">
          <div class="progress" aria-live="polite"><span id="prog"></span></div>
          <div id="progressText" class="sr-only" aria-hidden="false"></div>
          <button id="submit" class="btn" type="button" disabled>ê²°ê³¼ ë³´ê¸°</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div id="result" class="result" role="dialog" aria-modal="true" aria-labelledby="combo-title">
  <div class="result-card" id="resultCard" tabindex="-1">
    <div class="result-body">
      <h2 id="combo-title" class="result-title"></h2>
      <p id="theme-line" class="theme-line"></p>
      <p id="mbti-line" class="combo-title"></p>
      <div id="emoji-line" class="emoji-line"></div>
      <div id="bean-cards" class="bean-cards"></div>
      <p id="method-text" class="method-text"></p>
      <nav class="actions-line" aria-label="ìƒë‹¨ ë§í¬">| <a id="goLink" href="https://linktr.ee/Ne.coffee" target="_blank" rel="noopener">ë„¤,ì»¤í”¼ ë°”ë¡œ ê°€ê¸°</a> |</nav>
      <nav class="actions-line" aria-label="ê²°ê³¼ ì‘ì—…">| <a id="again" href="#">ë‹¤ì‹œ í•˜ê¸°</a> | <a id="share" href="#">ê³µìœ í•˜ê¸°</a> | <a id="copyLink" href="#">ë§í¬ ë³µì‚¬</a> | <a id="close" href="#">ë‹«ê¸°</a> |</nav>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
/* ===== ì›ë‘ ë°ì´í„° (ìµœì‹ ) ===== */
const TYPES={
  A:{en:"Chance",ko:"í–‰ìš´",cup:"ìº¬ë¼ë©œ, ë¡œìŠ¤íŠ¸ ì•„ëª¬ë“œ",emoji:"ğŸ€",color:"#F6C89F"},
  B:{en:"Amante",ko:"ì—°ì¸",cup:"ê±´ìë‘, ë ˆë“œì™€ì¸",emoji:"â¤ï¸",color:"#8E3A59"},
  C:{en:"Lune",ko:"ë‹¬",cup:"í™ì‹œ, ìº¬ë¼ë©œì‹œëŸ½",emoji:"ğŸŒ™",color:"#F7D794"},
  D:{en:"Colombia El encanto Aji Bourbon Yeast Natural",ko:"ì½œë¡¬ë¹„ì•„ ë‚´ì¶”ëŸ´",cup:"ë°”ë‚˜ë‚˜ìŠ¤í”Œë¦¿, ë½€ë˜, ë°€í‚¤",emoji:"ğŸŒ",color:"#E7798E"},
  E:{en:"Peru El Cedro Natural",ko:"í˜ë£¨ ë‚´ì¶”ëŸ´",cup:"ì‚¬í–¥ë²Œê¿€, ë°°ê³¼ì¦™, ì‹œë‚˜ëª¬",emoji:"ğŸ¯",color:"#D9A441"},
  F:{en:"Uganda Mount elgon Sironko Station Ananerobic Natural",ko:"ìš°ê°„ë‹¤ ë‚´ì¶”ëŸ´",cup:"ë ˆëª¬ìº”ë””, ë¸”ë£¨ë² ë¦¬, íƒœìš´ ìº¬ë¼ë©œ",emoji:"ğŸ«",color:"#C47C56"},
  G:{en:"Cameroon Oku Natural",ko:"ì¹´ë©”ë£¬ ë‚´ì¶”ëŸ´",cup:"êµ°ë°¤, ì°ê³ êµ¬ë§ˆ",emoji:"ğŸŒ°",color:"#8C6A43"},
  H:{en:"Ethiopia Aricha Washed",ko:"ì—í‹°ì˜¤í”¼ì•„ ì›Œì‹œë“œ",cup:"ë‹¤í¬ ì²´ë¦¬, ë°€í¬ ì´ˆì½œë ›",emoji:"ğŸ«",color:"#5A3E36"}
};

/* ì¡°í•© ì´ë¦„ + í…Œë§ˆ ì„¤ëª… */
const COMBO_TITLES={
  "A+B":{title:"í–‰ìš´ì˜ ì—°ì¸",theme:"ë¶€ë“œëŸ¬ìš´ ë‹¬ì½¤í•¨ê³¼ ë‚­ë§Œì´ ì–´ìš°ëŸ¬ì§„ ë”°ëœ»í•œ ì¡°í•©"},
  "A+C":{title:"ë‹¬ë¹› ì•„ë˜ í–‰ìš´",theme:"ë°ê³  ìƒì¾Œí•œ ê· í˜•, í¬ê·¼í•œ ê¸°ìš´ì˜ í•œ ëª¨ê¸ˆ"},
  "A+D":{title:"ë°”ë‚˜ë‚˜ ë°€í‚¤ ëª¨í—˜",theme:"ë°€í‚¤í•œ ë‹¨ë§›ê³¼ ê²½ì¾Œí•œ í–¥ì´ ì–´ìš°ëŸ¬ì§„ ì¦ê±°ìš´ ì—¬ì •"},
  "A+E":{title:"í™©ê¸ˆë¹› í–¥ì—°",theme:"ê¿€ê³¼ ê²¬ê³¼ê°€ ë…¹ì•„ë“  ë”°ëœ»í•œ í’ë¯¸ì˜ ì •ì„"},
  "A+F":{title:"ë ˆëª¬ë¹› í–‰ìš´",theme:"ë¸”ë£¨ë² ë¦¬ì˜ ë‹¬ì½¤í•¨ê³¼ ìƒí¼í•¨ì´ ì‚´ì•„ë‚˜ëŠ” ê· í˜•"},
  "A+G":{title:"ë”°ìŠ¤í•œ í–‰ìš´",theme:"ê³ ì†Œí•˜ê³  í¬ê·¼í•œ ê°ì´‰ìœ¼ë¡œ ì•ˆì •ê°ì„ ì£¼ëŠ” í•œ ì”"},
  "A+H":{title:"ë‹¬ì½¤í•œ ì¶•ë³µ",theme:"ì´ˆì½œë¦¿ í–¥ ì†ì— ë…¹ì•„ë“œëŠ” í¬ê·¼í•œ ë‹¬ì½¤í•¨"},
  "B+C":{title:"ë‹¬ë¹› ë¡œë§",theme:"ì€ì€í•œ ê³¼ì¼í–¥ê³¼ ì™€ì¸ì˜ ë¶€ë“œëŸ¬ì›€ì´ ê°ë„ëŠ” ê°ì„±ì ì¸ ì¡°í•©"},
  "B+D":{title:"ì—´ëŒ€ì˜ ì—°ì¸",theme:"ë°”ë‚˜ë‚˜ì™€ ê³¼ì‹¤ì˜ ë‹¬ì½¤í•¨ì´ ë¡œë§¨í‹±í•˜ê²Œ ì–´ìš°ëŸ¬ì§€ëŠ” í’ë¯¸"},
  "B+E":{title:"ê¿€ì²˜ëŸ¼ ë‹¬ì½¤í•œ ì‚¬ë‘",theme:"ê¿€í–¥ê³¼ ë¶‰ì€ ê³¼ì‹¤ì´ ë§Œë“¤ì–´ë‚´ëŠ” ë”°ëœ»í•œ í•˜ëª¨ë‹ˆ"},
  "B+F":{title:"ìƒí¼í•œ í¬ì˜¹",theme:"ë¸”ë£¨ë² ë¦¬ì˜ ë‹¨ë§›ê³¼ ìƒí¼í•¨ì´ ë§Œë‚˜ëŠ” í™œê¸°ì°¬ í•œ ì”"},
  "B+G":{title:"í¬ê·¼í•œ ì•½ì†",theme:"êµ¬ìš´ ê²¬ê³¼ì˜ ê¹Šì€ í’ë¯¸ ì†ì— ë‹´ê¸´ í¬ê·¼í•œ ê°ì •"},
  "B+H":{title:"ì´ˆì½œë¦¿ í‚¤ìŠ¤",theme:"ë¶€ë“œëŸ¬ìš´ ì´ˆì½œë¦¿ê³¼ ë ˆë“œë² ë¦¬ì˜ ê°ë¯¸ë¡œìš´ ì¡°í™”"},
  "C+D":{title:"ë‹¬ì˜ ëª¨í—˜",theme:"ë°”ë‚˜ë‚˜ ë°€í‚¤ í–¥ì´ ì–´ìš°ëŸ¬ì§„ ë¶€ë“œëŸ½ê³  ë‚­ë§Œì ì¸ ì¡°í•©"},
  "C+E":{title:"ë‹¬ë¹›ì˜ í–¥ê¸°",theme:"ë‹¬ì½¤í•œ ê¿€ë¹›ì— ê°ë„ëŠ” ì€ì€í•œ ì—¬ìš´"},
  "C+F":{title:"ë ˆëª¬ ë‹¬ë¹›",theme:"ë¸”ë£¨ë² ë¦¬ì™€ ë ˆëª¬ì˜ ì‚°ëœ»í•¨ì´ ë‹¬ë¹›ì²˜ëŸ¼ í¼ì§€ëŠ” ë§›"},
  "C+G":{title:"ë”°ëœ»í•œ ë‹¬ë¹›",theme:"ë¶€ë“œëŸ¬ìš´ ë‹¨ë§›ê³¼ ê³ ì†Œí•¨ì´ ì–´ìš°ëŸ¬ì§„ ì°¨ë¶„í•œ í•œ ëª¨ê¸ˆ"},
  "C+H":{title:"ë‹¬ë°¤ì˜ ì†ì‚­ì„",theme:"ì´ˆì½œë¦¿ í–¥ì´ ê°ì‹¸ëŠ” ë¶€ë“œëŸ¬ìš´ ìœ„ë¡œì˜ ì”"},
  "D+E":{title:"ë°€í‚¤ ê³¨ë“œ",theme:"ë°€í‚¤í•œ ì§ˆê°ê³¼ ê¿€ì˜ ë‹¬ì½¤í•¨ì´ ì–´ìš°ëŸ¬ì§„ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë°¸ëŸ°ìŠ¤"},
  "D+F":{title:"ë°”ë‚˜ë‚˜ ìº”ë”” ë“œë¦¼",theme:"ë°”ë‚˜ë‚˜ì™€ ë¸”ë£¨ë² ë¦¬ê°€ ì–´ìš°ëŸ¬ì§„ ê²½ì¾Œí•œ íŠ¸ë¡œí”¼ì»¬ ë¬´ë“œ"},
  "D+G":{title:"ë‹¬ì½¤í•œ ëª¨í—˜",theme:"ê³ ì†Œí•œ êµ¬ìš´ í–¥ ì†ì—ì„œ í¼ì§€ëŠ” ë°€í‚¤í•œ ë¶€ë“œëŸ¬ì›€"},
  "D+H":{title:"ë°€í‚¤ ë² ë¦¬ ë“œë¦¼",theme:"ë°€í‚¤í•œ ë‹¨ë§›ê³¼ ë² ë¦¬ì˜ ì‚°ë¯¸ê°€ ì¡°í™”ëœ í¬ë¦¬ë¯¸ í”¼ë‹ˆì‹œ"},
  "E+F":{title:"ê¿€ë¹› ìŠ¤íŒŒí´",theme:"ê¿€ì˜ ë‹¬ì½¤í•¨ ì†ì— ë¸”ë£¨ë² ë¦¬ì˜ ì²­ëŸ‰í•¨ì´ í”¼ì–´ì˜¤ë¥´ëŠ” í•œ ì”"},
  "E+G":{title:"í™©ê¸ˆë¹› ì˜¨ê¸°",theme:"ë”°ëœ»í•˜ê³  ì•ˆì •ì ì¸ í–¥ë¯¸ë¡œ ë§ˆìŒì„ ë…¹ì´ëŠ” ì¡°í™”"},
  "E+H":{title:"ë‹¬ì½¤í•œ ì„œì•½",theme:"ì´ˆì½œë¦¿ê³¼ ê¿€ì˜ ê¹Šì€ ë‹¨ë§›ì´ ì´ì–´ì£¼ëŠ” ë¶€ë“œëŸ¬ìš´ ì—¬ìš´"},
  "F+G":{title:"ë¸”ë£¨ë² ë¦¬ í–¥ì—°",theme:"ë¸”ë£¨ë² ë¦¬ì˜ í’ì„±í•œ í–¥ê³¼ êµ¬ìš´ í–¥ì´ ì–´ìš°ëŸ¬ì§„ ê²½ì¾Œí•œ ì¡°í•©"},
  "F+H":{title:"ë¸”ë£¨ë² ë¦¬ ìº¬ë¼ë©œ ë¸”ë£¨ìŠ¤",theme:"ë¸”ë£¨ë² ë¦¬ì™€ ìºëŸ¬ë©œ, ì´ˆì½œë¦¿ì˜ ì¬ì¦ˆ ê°™ì€ í•˜ëª¨ë‹ˆ"},
  "G+H":{title:"ê²¨ìš¸ë°¤ì˜ ê³ ë°±",theme:"ë”°ëœ»í•œ ê²¬ê³¼ì™€ ì´ˆì½œë¦¿ì˜ ë‹¬ì½¤í•¨ìœ¼ë¡œ ì™„ì„±ë˜ëŠ” í¬ê·¼í•œ í”¼ë‚ ë ˆ"}
};

/* MBTI ì˜¨ë„ ì¶”ì²œ */
const MBTI_TEMP={ ISTJ:{line1:"ì§ˆì„œ ì†ì˜ í‰ì˜¨,", line2:"ë”°ëœ»í•œ ì»µì´ í•˜ë£¨ë¥¼ ë‹¨ë‹¨í•˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”.", temp:"hot"}, ISFJ:{line1:"ì¡°ìš©í•œ ë°°ë ¤ì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ê¸°,", line2:"ë¶€ë“œëŸ½ê²Œ ìŠ¤ë©°ë“œëŠ” ë”°ëœ»í•¨ì„.", temp:"hot"}, INFJ:{line1:"ê³ ìš”í•œ ì‚¬ìƒ‰ì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ê¸°,", line2:"ë§ˆìŒì„ ê°ì‹¸ëŠ” í•œ ì”.", temp:"hot"}, INTJ:{line1:"ì„ ëª…í•œ ì§‘ì¤‘ì„ ìœ„í•œ ë”°ëœ»í•¨,", line2:"ì°¨ë¶„íˆ ì„¤ê³„ëœ í•œ ëª¨ê¸ˆ.", temp:"hot"}, ISTP:{line1:"ì„ íƒì€ ê°„ê²°í•˜ê²Œ,", line2:"ì°¨ê°‘ê²Œ ê¹”ë”í•œ í•œ ì”ì´ ë”±.", temp:"ice"}, ISFP:{line1:"ê°ê°ì— ìŠ¤ë©°ë“œëŠ” ì²­ëŸ‰í•¨,", line2:"ì°¨ê°‘ê²Œ ë” ì‚´ì•„ë‚˜ëŠ” ìˆœê°„ë“¤.", temp:"ice"}, INFP:{line1:"ì„¬ì„¸í•œ ë§ˆìŒì— ì”ì”í•œ ì˜¨ê¸°,", line2:"ë”°ëœ»í•¨ì´ ì˜¤ë˜ ë‚¨ì•„ìš”.", temp:"hot"}, INTP:{line1:"ë¨¸ë¦¿ì† íë¦„ì„ ê¹¨ìš°ëŠ” ì‹œì›í•¨,", line2:"ë§‘ê³  ì°¨ê°€ìš´ ì‚°ëœ»í•¨.", temp:"ice"}, ESTP:{line1:"ì§€ê¸ˆ ì´ ìˆœê°„,", line2:"ì°¨ê°‘ê²Œ í„°ì§€ëŠ” ë¦¬ë“¬ìœ¼ë¡œ ì†ë„ë¥¼ ì˜¬ë ¤ìš”.", temp:"ice"}, ESFP:{line1:"ë°˜ì§ì´ëŠ” ì˜¤ëŠ˜,", line2:"ì‹œì›í•¨ì´ ë” ë¹›ë‚˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”.", temp:"ice"}, ENFP:{line1:"í™œê¸°ì°¬ ìŠ¤íŒŒí¬ì— ì²­ëŸ‰í•œ ì‘ë‹µ,", line2:"ì°¨ê°‘ê²Œ ì‹íŒ í•œ ì”ìœ¼ë¡œ!", temp:"ice"}, ENTP:{line1:"ì•„ì´ë””ì–´ì˜ íŒŒë„ë¥¼ íƒ€ê³ ,", line2:"í¬ë¦¬ìŠ¤í”¼í•œ ì‹œì›í•¨ìœ¼ë¡œ ì „ê°œí•˜ì„¸ìš”.", temp:"ice"}, ESTJ:{line1:"ëª…í™•í•œ ê²°ì •ì„ ë•ëŠ” ì˜¨ê¸°,", line2:"ë‹¨ë‹¨í•˜ê³  ê¹”ë”í•œ ë”°ëœ»í•¨.", temp:"hot"}, ESFJ:{line1:"ë”°ëœ»í•œ ë§ˆìŒì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ë„,", line2:"ë¶€ë“œëŸ½ê²Œ í•¨ê»˜ ë¨¸ë¬´ëŠ” í•œ ì”.", temp:"hot"}, ENFJ:{line1:"ì‚¬ëŒê³¼ ìˆœê°„ì„ ì‡ëŠ” ì˜¨ê¸°,", line2:"ë§ˆìŒì„ ë°ì›Œì£¼ëŠ” ë”°ëœ»í•¨.", temp:"hot"}, ENTJ:{line1:"ì¶”ì§„ë ¥ì„ ìœ„í•œ ì§‘ì¤‘,", line2:"ëœ¨ê²ê²Œ ì •ë¦¬ë˜ëŠ” í•œ ëª¨ê¸ˆ.", temp:"hot"} };

/* ë°©ì‹ ë¬¸êµ¬ */
const METHODS={ M1:{ line1:"ì•„ë©”ë¦¬ì¹´ë…¸ë¡œ ì¦ê¸°ì„¸ìš”.", line2:"ì§„í•œ ë†ë„ì™€ ê¸´ ì—¬ìš´ì´ ëª°ì…ì„ ë” ê¹Šê²Œ í•´ì¤„ ê±°ì˜ˆìš”." }, M2:{ line1:"í•¸ë“œë“œë¦½ìœ¼ë¡œ ì¦ê¸°ì„¸ìš”.", line2:"ì„ ëª…í•œ í–¥ë¯¸ì™€ ê¹”ë”í•œ ì§ˆê°ì´", line3:"ì»¤í”¼ì˜ ì§„ì‹¬ì„ ë“œëŸ¬ë‚´ì¤„ ê±°ì˜ˆìš”." }, M3:{ line1:"ì½œë“œë¸Œë£¨ë¡œ ì¦ê¸°ì„¸ìš”.", line2:"ë¶€ë“œëŸ½ê³  ë‹¬ì½¤í•œ ì—¬ìš´ì´ ì‹œì›í•˜ê²Œ í•˜ë£¨ë¥¼ ë°”ê¿”ì¤„ ê±°ì˜ˆìš”." } };
const METHOD_EMOJI={M1:"â˜•ï¸",M2:"ğŸµ",M3:"ğŸ¥¤"};

/* ===== ìœ í‹¸ ===== */
const $=s=>document.querySelector(s); const form=$('#quiz'); const submitBtn=$('#submit'); const prog=$('#prog'); const progressText=$('#progressText');
function updateProgress(){ let count=0; const required=5; const ei=form.querySelector('input[name="mbti-ei"]:checked'); const ns=form.querySelector('input[name="mbti-ns"]:checked'); const ft=form.querySelector('input[name="mbti-ft"]:checked'); const jp=form.querySelector('input[name="mbti-jp"]:checked'); if(ei&&ns&&ft&&jp)count++; if(form.querySelector('input[name="q2"]:checked'))count++; if(form.querySelector('input[name="q3"]:checked'))count++; if(form.querySelector('input[name="q4"]:checked'))count++; if(form.querySelector('input[name="method"]:checked'))count++; const pct=Math.round((count/required)*100); prog.style.width=pct+'%'; progressText.textContent=`ì§„í–‰ë¥  ${pct}%`; submitBtn.disabled=count!==required; }
form.addEventListener('change',()=>{ saveToStorage(); updateProgress(); }); updateProgress();
function pairKey(a,b){return[a,b].sort().join('+');}
function getMBTI(){ const ei=form.querySelector('input[name="mbti-ei"]:checked')?.value||''; const ns=form.querySelector('input[name="mbti-ns"]:checked')?.value||''; const ft=form.querySelector('input[name="mbti-ft"]:checked')?.value||''; const jp=form.querySelector('input[name="mbti-jp"]:checked')?.value||''; return ei+ns+ft+jp; }

/* ===== ê²°ê³¼ ìƒì„± ===== */
function computeResult(){ const totals={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0}; ["q2","q3","q4"].forEach(q=>{ const sel=form.querySelector(`input[name="${q}"]:checked`); if(sel){ sel.value.split("").forEach(l=>totals[l]++); } }); const ei=form.querySelector('input[name="mbti-ei"]:checked')?.value; const ns=form.querySelector('input[name="mbti-ns"]:checked')?.value; const ft=form.querySelector('input[name="mbti-ft"]:checked')?.value; const jp=form.querySelector('input[name="mbti-jp"]:checked')?.value; if(ei==="E"){totals.F+=0.5;totals.B+=0.5;} else if(ei==="I"){totals.A+=0.5;totals.C+=0.5;} if(ns==="N"){totals.D+=0.5;totals.E+=0.5;} else if(ns==="S"){totals.G+=0.5;totals.H+=0.5;} if(ft==="F"){totals.B+=0.5;totals.C+=0.5;} else if(ft==="T"){totals.A+=0.5;totals.D+=0.5;} if(jp==="J"){totals.F+=0.5;totals.H+=0.5;} else if(jp==="P"){totals.E+=0.5;totals.G+=0.5;} const base = Object.keys(totals).reduce((m,k)=>{ m[k]=0; return m; },{}); const apply=(name,w)=>{ const sel=form.querySelector(`input[name="${name}"]:checked`); if(!sel) return; sel.value.split("").forEach(l=>base[l]+=w); }; apply('q2',4); apply('q4',3); apply('q3',2); if(ei){ (ei==="E"?['F','B']:['A','C']).forEach(l=> base[l]+=0.4); } if(ns){ (ns==="N"?['D','E']:['G','H']).forEach(l=> base[l]+=0.4); } if(ft){ (ft==="F"?['B','C']:['A','D']).forEach(l=> base[l]+=0.4); } if(jp){ (jp==="J"?['F','H']:['E','G']).forEach(l=> base[l]+=0.4); } const ordered = Object.keys(totals).sort((a,b)=>{ if(totals[b]!==totals[a]) return totals[b]-totals[a]; if(base[b]!==base[a]) return base[b]-base[a]; return a.localeCompare(b); }); return {top1:ordered[0], top2:ordered[1]}; }

function renderResult(){ const {top1, top2} = computeResult(); const T1=TYPES[top1], T2=TYPES[top2]; const comboObj=COMBO_TITLES[pairKey(top1,top2)]; const comboTitle= (typeof comboObj==='string') ? comboObj : (comboObj?.title || `${T1.ko}ì™€ ${T2.ko}ì˜ ì¡°í•©`); const comboTheme= (typeof comboObj==='object' && comboObj?.theme) ? comboObj.theme : ''; document.getElementById('combo-title').textContent=comboTitle; document.getElementById('theme-line').textContent=comboTheme; const mbti=getMBTI(); const meta=MBTI_TEMP[mbti] || {line1:"ì˜¤ëŠ˜ì˜ ì»¤í”¼ê°€ ì–´ìš¸ë¦¬ëŠ” ì˜¨ë„,", line2:"ë¶€ë“œëŸ½ê²Œ ë¨¸ë¬´ëŠ” í•œ ì”.", temp:"hot"}; document.getElementById('mbti-line').innerHTML = `${meta.line1}<br>${meta.line2}`; const methodKey=form.querySelector('input[name="method"]:checked')?.value||"M1"; const tempEmoji = (methodKey==="M3") ? "â„ï¸" : (meta.temp==="ice" ? "â„ï¸" : "ğŸ”¥"); const methodEmoji = METHOD_EMOJI[methodKey]; document.getElementById('emoji-line').textContent = `${T1.emoji}${T2.emoji}${tempEmoji}${methodEmoji}`; const beanCards=document.getElementById('bean-cards'); const koLine = key => TYPES[key].ko; beanCards.innerHTML = `
    <div class="bean">
      <p class="bean-title-en"><span class="dot" style="background:${TYPES[top1].color}"></span>${TYPES[top1].en}</p>
      <p class="bean-title-ko">${koLine(top1)}</p>
      <p class="bean-note">${TYPES[top1].cup}</p>
    </div>
    <div class="bean">
      <p class="bean-title-en"><span class="dot" style="background:${TYPES[top2].color}"></span>${TYPES[top2].en}</p>
      <p class="bean-title-ko">${koLine(top2)}</p>
      <p class="bean-note">${TYPES[top2].cup}</p>
    </div>`; const m = METHODS[methodKey]; let methodHtml = `${m.line1}<br>${m.line2}`; if(m.line3){ methodHtml += `<br>${m.line3}`; } document.getElementById('method-text').innerHTML = methodHtml; }

/* ===== ëª¨ë‹¬ ì œì–´ ===== */
const resultEl = document.getElementById('result'); const resultCard = document.getElementById('resultCard'); const againLink = document.getElementById('again'); const closeLink = document.getElementById('close'); const shareLink = document.getElementById('share'); const copyLink = document.getElementById('copyLink');
function trapFocus(e){ if(!resultEl.classList.contains('show')) return; const focusables = resultEl.querySelectorAll('a, button, [tabindex]:not([tabindex="-1"])'); if(!focusables.length) return; const first=focusables[0], last=focusables[focusables.length-1]; if(e.key==='Tab'){ if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); } else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); } } }
function showModal(){ resultEl.classList.add('show'); document.body.style.overflow='hidden'; setTimeout(()=>{ resultCard.focus(); }, 0); }
function hideModal(){ resultEl.classList.remove('show'); document.body.style.overflow=''; }

submitBtn.addEventListener('click', ()=>{ const required = [ ['mbti-ei','mbti-ns','mbti-ft','mbti-jp'], ['q2'],['q3'],['q4'],['method'] ]; const ok = required.every(g=> g.length>1 ? g.every(n=> form.querySelector(`input[name="${n}"]:checked`)) : !!form.querySelector(`input[name="${g[0]}"]:checked`) ); if(!ok){ toast('ëª¨ë“  ë¬¸í•­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } renderResult(); showModal(); history.replaceState(null,'', buildURLFromAnswers()); });
againLink.addEventListener('click', (e)=>{ e.preventDefault(); hideModal(); form.reset(); updateProgress(); localStorage.removeItem('necoffee-fit'); history.replaceState(null,'', location.pathname); window.scrollTo({top:0,behavior:'smooth'}); });
closeLink.addEventListener('click', (e)=>{ e.preventDefault(); hideModal(); });
resultEl.addEventListener('click', (e)=>{ if(e.target===resultEl) hideModal(); });
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && resultEl.classList.contains('show')) hideModal(); trapFocus(e); });

/* ===== ê³µìœ : ì¹´ë“œ ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸(ë‹µë³€ í¬í•¨ ë§í¬) ===== */
async function shareCard(e){ e.preventDefault(); const canvas = await html2canvas(document.getElementById('resultCard'), { backgroundColor:'#ffffff', scale: Math.max(2, window.devicePixelRatio||1), useCORS:true }); const dataUrl = canvas.toDataURL('image/png'); const blob = await (await fetch(dataUrl)).blob(); const file = new File([blob], 'ne-coffee-result.png', { type: 'image/png', lastModified: Date.now() }); const link = buildURLFromAnswers(true); const title='ë„¤,ì»¤í”¼ í•íŒ… í…ŒìŠ¤íŠ¸'; if (navigator.canShare && navigator.canShare({ files: [file] })) { try { await navigator.share({ files:[file], text: link, title }); return; } catch(_){} } if (navigator.share) { try { await navigator.share({ text: link, title }); return; } catch(_){} } try { await navigator.clipboard.writeText(link); toast('ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”.'); } catch(_) { toast('ë§í¬ ë³µì‚¬ ì‹¤íŒ¨. ì´ë¯¸ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.'); } const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='ne-coffee-result.png'; document.body.appendChild(a); a.click(); a.remove(); window.open(dataUrl, '_blank'); }
shareLink.addEventListener('click', shareCard);
copyLink.addEventListener('click', (e)=>{ e.preventDefault(); const link=buildURLFromAnswers(true); navigator.clipboard.writeText(link).then(()=>toast('ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”.')).catch(()=>toast('ë³µì‚¬ ì‹¤íŒ¨ ã… ã… ')); });

/* ===== ë°°ë„ˆ: ì„¸ì…˜ ë™ì•ˆ ëœë¤ ê³ ì • ===== */
(function(){ const imgEl = document.getElementById('bannerImg'); const BANNERS = ['banner1.jpg','banner2.jpg','banner3.jpg','banner4.jpg','banner5.jpg','banner6.jpg']; const key='necoffee-banner-pick'; let pick=sessionStorage.getItem(key); if(!pick){ pick = BANNERS[Math.floor(Math.random()*BANNERS.length)]; sessionStorage.setItem(key,pick); } const pre = new Image(); pre.src = pick; imgEl.style.opacity = .3; pre.onload = ()=>{ imgEl.src = pick; imgEl.style.opacity = .82; }; setTimeout(()=>{ imgEl.src = pick; imgEl.style.opacity = .82; }, 80); })();

/* ===== ì €ì¥/ë³µì› & ë”¥ë§í¬ ===== */
function saveToStorage(){ const data = serializeAnswers(); localStorage.setItem('necoffee-fit', JSON.stringify(data)); }
function restoreFromStorage(){ try{ const saved = JSON.parse(localStorage.getItem('necoffee-fit')||'null'); if(saved) applyAnswers(saved); }catch(_){ }}
function serializeAnswers(){ const get=(name)=> form.querySelector(`input[name="${name}"]:checked`)?.value||''; return { ei:get('mbti-ei'), ns:get('mbti-ns'), ft:get('mbti-ft'), jp:get('mbti-jp'), q2:get('q2'), q3:get('q3'), q4:get('q4'), m:get('method') }; }
function applyAnswers(obj){ const map={ 'mbti-ei':'ei', 'mbti-ns':'ns', 'mbti-ft':'ft', 'mbti-jp':'jp', 'q2':'q2', 'q3':'q3', 'q4':'q4', 'method':'m' }; Object.entries(map).forEach(([name,key])=>{ if(!obj[key]) return; const sel = form.querySelector(`input[name="${name}"][value="${obj[key]}"]`); if(sel){ sel.checked=true; } }); updateProgress(); }
function buildURLFromAnswers(includeOrigin=false){ const a=serializeAnswers(); const params=new URLSearchParams(a); const base = includeOrigin ? (location.origin+location.pathname) : location.pathname; return base + '?' + params.toString(); }
function loadFromQuery(){ const p = new URLSearchParams(location.search); if(!p.toString()) return false; const obj={ ei:p.get('ei')||'', ns:p.get('ns')||'', ft:p.get('ft')||'', jp:p.get('jp')||'', q2:p.get('q2')||'', q3:p.get('q3')||'', q4:p.get('q4')||'', m:p.get('m')||'' }; applyAnswers(obj); const all = Object.values(obj).every(v=>v && v.length); if(all){ renderResult(); showModal(); } return all; }

/* ===== í† ìŠ¤íŠ¸ ===== */
function toast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1400); }

// ì´ˆê¸°í™”
restoreFromStorage();
updateProgress();
loadFromQuery();
</script>
</body>
</html>
