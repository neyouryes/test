<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ne, Coffee Fitting Test</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --ink:#3B2A22; --ink-2:#5A4034; --accent:#6A4B3B;
  --surface:rgba(255,255,255,.92); --border:#E7DED6;
}
*{box-sizing:border-box}
body{
  font-family:'Noto Serif KR', serif;
  color:var(--ink); line-height:1.6;
  background:#f7f2ef; margin:0; font-size:16px;
}
.wrap{max-width:860px;margin:0 auto;padding:0 16px 72px}
.banner{position:relative;margin:0 -16px 12px;aspect-ratio:16/5;border-radius:16px;overflow:hidden;background:#000}
.banner img{width:100%;height:100%;object-fit:cover;display:block;opacity:.8}
.banner-text{position:absolute;bottom:14px;left:16px;display:flex;flex-direction:column;gap:2px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.35)}
.banner-top{font-weight:700;font-size:1.6rem;line-height:1.2}
.banner-bottom{font-size:0.9rem;opacity:.9}

/* ì¹´ë“œ */
.card{background:var(--surface);border-radius:16px;box-shadow:0 10px 30px rgba(59,42,34,.18);padding:16px;margin-top:10px;border:1px solid var(--border)}
.title{margin:4px 0 2px;font-size:1.35rem;font-weight:700}
.desc{margin:0 0 12px;color:var(--ink-2);font-size:.95rem}

/* ë¬¸í•­ */
.q{padding:12px 0;border-top:1px dashed var(--border)}
.q:first-child{border-top:0}
.q-title{font-size:1.05rem;margin:4px 0 8px;font-weight:700}
.opts{display:grid;gap:8px}
.opt{position:relative}
.opt input{position:absolute;opacity:0;pointer-events:none}
.opt label{
  display:block;background:#fff;border:1.5px solid var(--border);border-radius:12px;padding:10px 12px;cursor:pointer;
  transition:box-shadow .15s ease,border-color .15s ease,transform .05s ease;
}
.opt label:active{transform:scale(.995)}
.opt input:checked + label{border-color:var(--accent);box-shadow:0 0 0 2px rgba(106,75,59,.12) inset}

/* ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ ë°” */
.gradient-bar {
  position: relative;
  height: 40px;
  border-radius: 10px;
  overflow: hidden;
  background: linear-gradient(
    to right,
    #F5E08C, #F9D28E, #F6B48F, #E6A18F,
    #F28C8C, #C3A6E8, #C9A588, #B58C8C
  );
  display: flex;
  margin-top: 10px;
}
.gradient-bar label { flex:1; cursor:pointer; position:relative; }
.gradient-bar input { display:none; }
.gradient-bar span { display:block; width:100%; height:100%; }
.gradient-bar input:checked + span {
  outline: 3px solid var(--accent);
  outline-offset: -3px;
  border-radius: 4px;
}

/* ì œì¶œ ë°” */
.submitbar{position:sticky;bottom:0;margin-top:12px;z-index:20}
.submitcard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:10px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 24px rgba(59,42,34,.18)}
.progress{flex:1;height:8px;background:#efe6de;border-radius:999px;overflow:hidden;position:relative}
.progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#3b2a22);transition:width .3s ease}
.btn{border:0;border-radius:12px;padding:10px 14px;font-size:.95rem;cursor:pointer;color:#fff;background:linear-gradient(180deg,#3b2a22,#2c1f19)}
.btn[disabled]{opacity:.55;cursor:not-allowed}

/* ê²°ê³¼ ëª¨ë‹¬ */
.result{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
.result.show{display:flex}
.result-card{max-width:760px;width:100%;background:#fff;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden;position:relative}
.result-body{padding:18px 16px 20px;color:#2a1d18}
.result-title{font-size:1.5rem;margin:4px 0 6px;font-weight:800}
.combo-title{font-size:1.05rem;color:#6a4b3b;margin:0 0 10px;font-weight:600}
.emoji-line{text-align:center;font-size:1.35rem;margin:10px 0}
.bean-cards{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.bean{border:1px solid var(--border);border-radius:14px;padding:10px;background:#fefcfa;text-align:center}
.bean-title{font-weight:700;font-size:1rem;margin:0}
.bean-note{font-size:0.9rem;margin:4px 0 0}
.dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:6px;vertical-align:middle}
.method-text{margin-top:14px;font-size:1rem;font-weight:500;color:#3b2a22;text-align:center}
.actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
.btn-secondary{background:#efe6de;color:#3b2a22;border:0;border-radius:12px;padding:10px 14px;cursor:pointer}
.close{background:#3b2a22;color:#fff;border:0;border-radius:12px;padding:10px 14px;cursor:pointer}
.first{background:#6a4b3b;color:#fff;border:0;border-radius:12px;padding:10px 14px;cursor:pointer}

/* ìŠ¤í¬ë¦°ë¦¬ë” ì „ìš© */
.sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ê°€ì‹œí™” */
.opt input:focus-visible + label,
.gradient-bar input:focus-visible + span,
.btn:focus-visible, .btn-secondary:focus-visible, .close:focus-visible, .first:focus-visible {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
  border-radius: 6px;
}

/* ëª¨ì…˜ ë¯¼ê° ì‚¬ìš©ì ë°°ë ¤ */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition: none !important; }
}

/* Q1 ë‘ íƒ€ì… Ã— 2ì¤„ ë ˆì´ì•„ì›ƒ */
.mbti-rows { display: grid; gap: 12px; }
.mbti-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
.pair { 
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  gap: 8px; 
  border: 1px dashed var(--border);
  border-radius: 10px; 
  padding: 10px;
  background: #fff;
}
.pair-legend {
  grid-column: 1 / -1;
  font-size: .85rem;
  color: var(--ink-2);
  margin: -2px 0 4px;
}
/* ë„“ì€ í™”ë©´ì—ì„œ ê° ì¤„ì— ë‘ ê·¸ë£¹(EI/NS, FT/JP) ë‚˜ë€íˆ */
@media (min-width: 560px){
  .mbti-row { grid-template-columns: 1fr 1fr; }
}

/* ë°°ë„ˆ í˜ì´ë“œ-ì¸(ì˜µì…˜) */
.banner img.fade-in { opacity: 0; transition: opacity .4s ease; }
.banner img.fade-in.loaded { opacity: .8; }

/* ëª¨ë°”ì¼ */
@media (max-width:560px){
  body{font-size:14px;line-height:1.45}
  .title{font-size:1.2rem}
  .banner-top{font-size:1.2rem}
  .banner-bottom{font-size:0.8rem}
  .result-title{font-size:1.3rem}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="banner">
    <img id="bannerImg" src="banner1.jpg" alt="ë„¤,ì»¤í”¼ â€” ì·¨í–¥ì— ë§ëŠ” ì›ë‘ë¥¼ ì°¾ì•„ì£¼ëŠ” í•íŒ… í…ŒìŠ¤íŠ¸ ë°°ë„ˆ">
    <div class="banner-text">
      <div class="banner-top">Ne, Coffee Fitting Test</div>
      <div class="banner-bottom">ë„¤,ì»¤í”¼ í•íŒ… í…ŒìŠ¤íŠ¸</div>
    </div>
  </div>

  <div class="card">
    <h1 class="title">ë„¤,ì»¤í”¼ í•íŒ… í…ŒìŠ¤íŠ¸</h1>
    <p class="desc">5ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•˜ë©´, ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ì›ë‘ ì¡°í•©ê³¼ ë§ˆì‹œëŠ” ë°©ì‹ì´ ì œì•ˆë©ë‹ˆë‹¤.</p>

    <form id="quiz">
      <!-- Q1. MBTI (ë‘ íƒ€ì… Ã— 2ì¤„ ë ˆì´ì•„ì›ƒ) -->
      <section class="q" aria-labelledby="q1-label">
        <div id="q1-label" class="q-title">Q1. ë‚˜ì˜ MBTIëŠ”?</div>

        <div class="mbti-rows">
          <!-- ì¤„ 1: EI / NS -->
          <div class="mbti-row">
            <!-- EI -->
            <fieldset class="pair" role="radiogroup" aria-label="ì™¸í–¥/ë‚´í–¥">
              <legend class="pair-legend">E / I</legend>
              <div class="opt"><input id="ei-e" type="radio" name="mbti-ei" value="E"><label for="ei-e">E (ì™¸í–¥)</label></div>
              <div class="opt"><input id="ei-i" type="radio" name="mbti-ei" value="I"><label for="ei-i">I (ë‚´í–¥)</label></div>
            </fieldset>

            <!-- NS -->
            <fieldset class="pair" role="radiogroup" aria-label="ì§ê´€/ê°ê°">
              <legend class="pair-legend">N / S</legend>
              <div class="opt"><input id="ns-n" type="radio" name="mbti-ns" value="N"><label for="ns-n">N (ì§ê´€)</label></div>
              <div class="opt"><input id="ns-s" type="radio" name="mbti-ns" value="S"><label for="ns-s">S (ê°ê°)</label></div>
            </fieldset>
          </div>

          <!-- ì¤„ 2: FT / JP -->
          <div class="mbti-row">
            <!-- FT -->
            <fieldset class="pair" role="radiogroup" aria-label="ê°ì •/ì‚¬ê³ ">
              <legend class="pair-legend">F / T</legend>
              <div class="opt"><input id="ft-f" type="radio" name="mbti-ft" value="F"><label for="ft-f">F (ê°ì •)</label></div>
              <div class="opt"><input id="ft-t" type="radio" name="mbti-ft" value="T"><label for="ft-t">T (ì‚¬ê³ )</label></div>
            </fieldset>

            <!-- JP -->
            <fieldset class="pair" role="radiogroup" aria-label="ê³„íš/ì¸ì‹">
              <legend class="pair-legend">J / P</legend>
              <div class="opt"><input id="jp-j" type="radio" name="mbti-jp" value="J"><label for="jp-j">J (ê³„íš)</label></div>
              <div class="opt"><input id="jp-p" type="radio" name="mbti-jp" value="P"><label for="jp-p">P (ì¸ì‹)</label></div>
            </fieldset>
          </div>
        </div>
      </section>

      <!-- Q2. í–¥ë¯¸ -->
      <section class="q" aria-labelledby="q2-label">
        <div id="q2-label" class="q-title">Q2. ë‚´ê°€ ëŒë¦¬ëŠ” ì»¤í”¼ì˜ í–¥ë¯¸ëŠ”?</div>
        <div class="opts">
          <div class="opt"><input id="q2-1" type="radio" name="q2" value="AG"><label for="q2-1">ë¬µì§í•˜ê³  ì§„í•œ ë¡œìŠ¤í‹°ë“œ í’ë¯¸</label></div>
          <div class="opt"><input id="q2-2" type="radio" name="q2" value="BH"><label for="q2-2">ê³ ì†Œí•˜ê³  ë”°ëœ»í•œ ë‹¬ì½¤í•¨</label></div>
          <div class="opt"><input id="q2-3" type="radio" name="q2" value="CF"><label for="q2-3">ìƒí¼í•˜ê³  í™œë ¥ ë„˜ì¹˜ëŠ” ê³¼ì¼í–¥</label></div>
          <div class="opt"><input id="q2-4" type="radio" name="q2" value="DE"><label for="q2-4">ì„¬ì„¸í•˜ê³  íŠ¹ë³„í•œ ê½ƒ/ìŠ¤íŒŒì´ì‹œ í–¥</label></div>
        </div>
      </section>

      <!-- Q3. ìƒ‰ìƒ -->
      <section class="q" aria-labelledby="q3-label">
        <div id="q3-label" class="q-title">Q3. ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ì»¤í”¼ì˜ ìƒ‰ê°ì€?</div>
        <div class="gradient-bar" role="radiogroup" aria-labelledby="q3-label">
          <label><input type="radio" name="q3" value="E" aria-label="ë°ì€ ê¿€ë¹› ê³„ì—´"><span></span></label>
          <label><input type="radio" name="q3" value="C" aria-label="ì—°í•œ ì¹´ë¼ë©œí†¤"><span></span></label>
          <label><input type="radio" name="q3" value="A" aria-label="ì‚´êµ¬ë¹› ë¡œìŠ¤í‹°"><span></span></label>
          <label><input type="radio" name="q3" value="F" aria-label="ì›œ ë¡œì¦ˆí†¤"><span></span></label>
          <label><input type="radio" name="q3" value="D" aria-label="í•‘í¬ë¹› ë² ë¦¬í†¤"><span></span></label>
          <label><input type="radio" name="q3" value="B" aria-label="ë¼ì¼ë½ ì´ˆì½œë¦¿í†¤"><span></span></label>
          <label><input type="radio" name="q3" value="G" aria-label="ê³ ë™ ê³„ì—´"><span></span></label>
          <label><input type="radio" name="q3" value="H" aria-label="ë‹¤í¬ ì¹´ì¹´ì˜¤í†¤"><span></span></label>
        </div>
      </section>

      <!-- Q4. ê¸°ë¶„ -->
      <section class="q" aria-labelledby="q4-label">
        <div id="q4-label" class="q-title">Q4. ì§€ê¸ˆì˜ ë‚˜ì™€ ê°€ê¹Œìš´ ê¸°ë¶„ì€?</div>
        <div class="opts">
          <div class="opt"><input id="q4-1" type="radio" name="q4" value="AD"><label for="q4-1">ê°•ë ¬í•œ ì§‘ì¤‘ê³¼ ì—ë„ˆì§€ê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-2" type="radio" name="q4" value="BG"><label for="q4-2">ì‚¬ë‘ê³¼ ìœ„ë¡œê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-3" type="radio" name="q4" value="CE"><label for="q4-3">ì°¨ë¶„í•œ íœ´ì‹ê³¼ ì—¬ìœ ê°€ í•„ìš”í•´ìš”</label></div>
          <div class="opt"><input id="q4-4" type="radio" name="q4" value="FH"><label for="q4-4">í™œë ¥ê³¼ ë‹¬ì½¤í•œ ê¸°ë¶„ ì „í™˜ì´ í•„ìš”í•´ìš”</label></div>
        </div>
      </section>

      <!-- Q5. ë°©ì‹ ì„±í–¥ -->
      <section class="q" aria-labelledby="q5-label">
        <div id="q5-label" class="q-title">Q5. ì»¤í”¼ë¥¼ ì¦ê¸¸ ë•Œ ë‚˜ëŠ”?</div>
        <div class="opts">
          <div class="opt"><input id="m1" type="radio" name="method" value="M1"><label for="m1">ì§„í•˜ê³  ì˜¤ë˜ ê°€ëŠ” í˜ìœ¼ë¡œ ì§‘ì¤‘ì„ ì›í•´ìš”</label></div>
          <div class="opt"><input id="m2" type="radio" name="method" value="M2"><label for="m2">í–¥ë¯¸ë¥¼ ì„¬ì„¸í•˜ê²Œ ìŒë¯¸í•˜ê³  ì‹¶ì–´ìš”</label></div>
          <div class="opt"><input id="m3" type="radio" name="method" value="M3"><label for="m3">ë‹¬ì½¤í•˜ê³  ì‹œì›í•œ ì „í™˜ì´ í•„ìš”í•´ìš”</label></div>
        </div>
      </section>

      <div class="submitbar">
        <div class="submitcard">
          <div class="progress" aria-live="polite"><span id="prog"></span></div>
          <button id="submit" class="btn" type="button" disabled>ê²°ê³¼ ë³´ê¸°</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div id="result" class="result" role="dialog" aria-modal="true" aria-labelledby="combo-title">
  <div class="result-card">
    <div class="result-body">
      <!-- 1. ê°ì„± íƒ€ì´í‹€ -->
      <h2 id="combo-title" class="result-title"></h2>
      <!-- 2. MBTI ê¸°ë°˜ ì˜¨ë„ ì¶”ì²œ ê¸€ê·€ (ê¸€ìë§Œ) -->
      <p id="mbti-line" class="combo-title"></p>
      <!-- 3. ì´ëª¨ì§€ ë¼ì¸ (ì›ë‘2 + HOT/ICE + ë°©ì‹) -->
      <div id="emoji-line" class="emoji-line"></div>
      <!-- 4. ì›ë‘ ì¹´ë“œ (ìœ„/ì•„ë˜) -->
      <div id="bean-cards" class="bean-cards"></div>
      <!-- 5. ì¶”ì²œ ë°©ì‹ ê²°ê³¼ (ê¸€ê·€ë§Œ) -->
      <p id="method-text" class="method-text"></p>

      <div class="actions">
        <button id="first" class="first" type="button">ì²«í™”ë©´ìœ¼ë¡œ</button>
        <button id="again" class="btn-secondary" type="button">ë‹¤ì‹œ í•˜ê¸°</button>
        <button id="close" class="close" type="button">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== ë°ì´í„° ì„¸íŠ¸ ===== */
const TYPES={
  A:{en:"Chance",ko:"í–‰ìš´",cup:"ìº¬ë¼ë©œ, ë¡œìŠ¤íŠ¸ ì•„ëª¬ë“œ",emoji:"ğŸ€",color:"#F6B48F"},
  B:{en:"Amante",ko:"ì—°ì¸",cup:"ê±´ìë‘, ë ˆë“œì™€ì¸",emoji:"â¤ï¸",color:"#C3A6E8"},
  C:{en:"Lune",ko:"ë‹¬",cup:"í™ì‹œ, ìº¬ë¼ë©œì‹œëŸ½",emoji:"ğŸŒ™",color:"#F9D28E"},
  D:{en:"Colombia El Diviso Washed",ko:"ì½œë¡¬ë¹„ì•„ ì›Œì‹œë“œ",cup:"ë¼ì¦ˆë² ë¦¬, ë¸”ë£¨ë² ë¦¬, í’ì„ ê»Œ",emoji:"ğŸ“",color:"#F28C8C"},
  E:{en:"Peru El Cedro Natural",ko:"í˜ë£¨ ë‚´ì¶”ëŸ´",cup:"ì‚¬í–¥ë²Œê¿€, ë°°ê³¼ì¦™, ì‹œë‚˜ëª¬",emoji:"ğŸ¯",color:"#F5E08C"},
  F:{en:"Rwanda Gitoki Washed",ko:"ë¥´ì™„ë‹¤ ì›Œì‹œë“œ",cup:"ìë‘, ì¹µí…Œì¼",emoji:"ğŸ’",color:"#E6A18F"},
  G:{en:"Cameroon Oku Natural",ko:"ì¹´ë©”ë£¬ ë‚´ì¶”ëŸ´",cup:"êµ°ë°¤, ì°ê³ êµ¬ë§ˆ",emoji:"ğŸŒ°",color:"#C9A588"},
  H:{en:"Ethiopia Aricha Washed",ko:"ì—í‹°ì˜¤í”¼ì•„ ì›Œì‹œë“œ",cup:"ë‹¤í¬ ì²´ë¦¬, ë°€í¬ ì´ˆì½œë ›",emoji:"ğŸ«",color:"#B58C8C"}
};

const COMBO_TITLES={
  "A+B":"í–‰ìš´ì˜ ì—°ì¸","A+C":"ë‹¬ë¹› ì•„ë˜ í–‰ìš´","A+D":"ìš´ëª…ì˜ ëª¨í—˜","A+E":"í™©ê¸ˆë¹› í–¥ì—°","A+F":"ì—´ì •ì˜ ë³„ë¹›","A+G":"ë”°ìŠ¤í•œ í–‰ìš´","A+H":"ë‹¬ì½¤í•œ ì¶•ë³µ",
  "B+C":"ë‹¬ë¹› ë¡œë§","B+D":"ì‚¬ë‘ì˜ í•­í•´","B+E":"ê¿€ì²˜ëŸ¼ ë‹¬ì½¤í•œ ì‚¬ë‘","B+F":"ë¶ˆê½ƒ ê°™ì€ ì—°ì •","B+G":"í¬ê·¼í•œ ì•½ì†","B+H":"ì´ˆì½œë¦¿ í‚¤ìŠ¤",
  "C+D":"ë‹¬ê³¼ ì—´ì •ì˜ ì—¬ì •","C+E":"ë‹¬ë¹›ì˜ í–¥ê¸°","C+F":"ë‹¬ì˜ ë¶ˆê½ƒ","C+G":"ë”°ëœ»í•œ ë‹¬ë¹›","C+H":"ë‹¬ë°¤ì˜ ì†ì‚­ì„",
  "D+E":"ê³¼ì¼ë¹› ì—°ê°€","D+F":"ë³„ë¹› ì—´ì •","D+G":"ëª¨í—˜ì˜ ê¸°ì–µ","D+H":"ë² ë¦¬ì˜ ì„œì •",
  "E+F":"ê¿€ë¹› ë¶ˆê½ƒ","E+G":"í™©ê¸ˆë¹› ì˜¨ê¸°","E+H":"ë‹¬ì½¤í•œ ì„œì•½",
  "F+G":"ìº í”„íŒŒì´ì–´ ë¡œë§ìŠ¤","F+H":"ì¹µí…Œì¼ í‚¤ìŠ¤",
  "G+H":"ê²¨ìš¸ë°¤ì˜ ê³ ë°±"
};

const MBTI_TEMP={
  ISTJ:{line:"ì§ˆì„œ ì†ì˜ í‰ì˜¨, ë”°ëœ»í•œ ì»µì´ í•˜ë£¨ë¥¼ ë‹¨ë‹¨í•˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”.", temp:"hot"},
  ISFJ:{line:"ì¡°ìš©í•œ ë°°ë ¤ì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ê¸°, ë¶€ë“œëŸ½ê²Œ ìŠ¤ë©°ë“œëŠ” ë”°ëœ»í•¨ì„.", temp:"hot"},
  INFJ:{line:"ê³ ìš”í•œ ì‚¬ìƒ‰ì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ê¸°, ë§ˆìŒì„ ê°ì‹¸ëŠ” í•œ ì”.", temp:"hot"},
  INTJ:{line:"ì„ ëª…í•œ ì§‘ì¤‘ì„ ìœ„í•œ ë”°ëœ»í•¨, ì°¨ë¶„íˆ ì„¤ê³„ëœ í•œ ëª¨ê¸ˆ.", temp:"hot"},
  ISTP:{line:"ì„ íƒì€ ê°„ê²°í•˜ê²Œ, ì°¨ê°‘ê²Œ ê¹”ë”í•œ í•œ ì”ì´ ë”±.", temp:"ice"},
  ISFP:{line:"ê°ê°ì— ìŠ¤ë©°ë“œëŠ” ì²­ëŸ‰í•¨, ì°¨ê°‘ê²Œ ë” ì‚´ì•„ë‚˜ëŠ” ìˆœê°„ë“¤.", temp:"ice"},
  INFP:{line:"ì„¬ì„¸í•œ ë§ˆìŒì— ì”ì”í•œ ì˜¨ê¸°, ë”°ëœ»í•¨ì´ ì˜¤ë˜ ë‚¨ì•„ìš”.", temp:"hot"},
  INTP:{line:"ë¨¸ë¦¿ì† íë¦„ì„ ê¹¨ìš°ëŠ” ì‹œì›í•¨, ë§‘ê³  ì°¨ê°€ìš´ ì‚°ëœ»í•¨.", temp:"ice"},
  ESTP:{line:"ì§€ê¸ˆ ì´ ìˆœê°„, ì°¨ê°‘ê²Œ í„°ì§€ëŠ” ë¦¬ë“¬ìœ¼ë¡œ ì†ë„ë¥¼ ì˜¬ë ¤ìš”.", temp:"ice"},
  ESFP:{line:"ë°˜ì§ì´ëŠ” ì˜¤ëŠ˜, ì‹œì›í•¨ì´ ë” ë¹›ë‚˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”.", temp:"ice"},
  ENFP:{line:"í™œê¸°ì°¬ ìŠ¤íŒŒí¬ì— ì²­ëŸ‰í•œ ì‘ë‹µ, ì°¨ê°‘ê²Œ ì‹íŒ í•œ ì”ìœ¼ë¡œ!", temp:"ice"},
  ENTP:{line:"ì•„ì´ë””ì–´ì˜ íŒŒë„ë¥¼ íƒ€ê³ , í¬ë¦¬ìŠ¤í”¼í•œ ì‹œì›í•¨ìœ¼ë¡œ ì „ê°œí•˜ì„¸ìš”.", temp:"ice"},
  ESTJ:{line:"ëª…í™•í•œ ê²°ì •ì„ ë•ëŠ” ì˜¨ê¸°, ë‹¨ë‹¨í•˜ê³  ê¹”ë”í•œ ë”°ëœ»í•¨.", temp:"hot"},
  ESFJ:{line:"ë”°ëœ»í•œ ë§ˆìŒì— ì–´ìš¸ë¦¬ëŠ” ì˜¨ë„, ë¶€ë“œëŸ½ê²Œ í•¨ê»˜ ë¨¸ë¬´ëŠ” í•œ ì”.", temp:"hot"},
  ENFJ:{line:"ì‚¬ëŒê³¼ ìˆœê°„ì„ ì‡ëŠ” ì˜¨ê¸°, ë§ˆìŒì„ ë°ì›Œì£¼ëŠ” ë”°ëœ»í•¨.", temp:"hot"},
  ENTJ:{line:"ì¶”ì§„ë ¥ì„ ìœ„í•œ ì§‘ì¤‘, ëœ¨ê²ê²Œ ì •ë¦¬ë˜ëŠ” í•œ ëª¨ê¸ˆ.", temp:"hot"}
};

const METHODS={
  M1:{text:"ì•„ë©”ë¦¬ì¹´ë…¸ë¡œ ì¦ê¸°ì„¸ìš”. ì§„í•œ ë†ë„ì™€ ê¸´ ì—¬ìš´ì´ ë‹¹ì‹ ì˜ ëª°ì…ì„ ë” ê¹Šê²Œ ë§Œë“¤ì–´ì¤„ ê±°ì˜ˆìš”."},
  M2:{text:"í•¸ë“œë“œë¦½ìœ¼ë¡œ ì¦ê¸°ì„¸ìš”. ì„ ëª…í•œ í–¥ë¯¸ì™€ ê¹”ë”í•œ ì§ˆê°ì´ ì»¤í”¼ì˜ ì§„ì‹¬ì„ ë“œëŸ¬ë‚´ì¤„ ê±°ì˜ˆìš”."},
  M3:{text:"ì½œë“œë¸Œë£¨ë¡œ ì¦ê¸°ì„¸ìš”. ë¶€ë“œëŸ½ê³  ë‹¬ì½¤í•œ ì—¬ìš´ì´ ì‹œì›í•˜ê²Œ í•˜ë£¨ë¥¼ ë°”ê¿”ì¤„ ê±°ì˜ˆìš”."}
};

const METHOD_EMOJI={M1:"â˜•ï¸",M2:"ğŸµ",M3:"ğŸ¥¤"};
const TEMP_EMOJI={hot:"ğŸ”¥",ice:"â„ï¸"};

/* ===== í¼ ì§„í–‰/ìœ í‹¸ ===== */
const form=document.getElementById('quiz');
const submitBtn=document.getElementById('submit');
const prog=document.getElementById('prog');

function updateProgress(){
  let count=0;const required=5;
  const ei=form.querySelector('input[name="mbti-ei"]:checked');
  const ns=form.querySelector('input[name="mbti-ns"]:checked');
  const ft=form.querySelector('input[name="mbti-ft"]:checked');
  const jp=form.querySelector('input[name="mbti-jp"]:checked');
  if(ei&&ns&&ft&&jp)count++;
  if(form.querySelector('input[name="q2"]:checked'))count++;
  if(form.querySelector('input[name="q3"]:checked'))count++;
  if(form.querySelector('input[name="q4"]:checked'))count++;
  if(form.querySelector('input[name="method"]:checked'))count++;
  const pct=Math.round((count/required)*100);
  prog.style.width=pct+'%';
  submitBtn.disabled=count!==required;
}
form.addEventListener('change',updateProgress);updateProgress();

function pairKey(a,b){return[a,b].sort().join('+');}
function dot(hex){return`<span class="dot" style="background:${hex}"></span>`;}
function getMBTI(){
  const ei=form.querySelector('input[name="mbti-ei"]:checked')?.value||'';
  const ns=form.querySelector('input[name="mbti-ns"]:checked')?.value||'';
  const ft=form.querySelector('input[name="mbti-ft"]:checked')?.value||'';
  const jp=form.querySelector('input[name="mbti-jp"]:checked')?.value||'';
  return ei+ns+ft+jp;
}

/* ===== ê²°ê³¼ ìƒì„± (íƒ€ì´ë¸Œë ˆì´ì»¤ & ì ‘ê·¼ì„± í¬í•¨) ===== */
function computeResult(){
  // ì ìˆ˜ ì§‘ê³„
  const totals={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0};
  ["q2","q3","q4"].forEach(q=>{
    const sel=form.querySelector(`input[name="${q}"]:checked`);
    if(sel){ sel.value.split("").forEach(l=>totals[l]++); }
  });

  const ei=form.querySelector('input[name="mbti-ei"]:checked')?.value;
  const ns=form.querySelector('input[name="mbti-ns"]:checked')?.value;
  const ft=form.querySelector('input[name="mbti-ft"]:checked')?.value;
  const jp=form.querySelector('input[name="mbti-jp"]:checked')?.value;
  // MBTI ë³´ì¡° ê°€ì¤‘ì¹˜(0.5ì”©)
  if(ei==="E"){totals.F+=0.5;totals.B+=0.5;} else if(ei==="I"){totals.A+=0.5;totals.C+=0.5;}
  if(ns==="N"){totals.D+=0.5;totals.E+=0.5;} else if(ns==="S"){totals.G+=0.5;totals.H+=0.5;}
  if(ft==="F"){totals.B+=0.5;totals.C+=0.5;} else if(ft==="T"){totals.A+=0.5;totals.D+=0.5;}
  if(jp==="J"){totals.F+=0.5;totals.H+=0.5;} else if(jp==="P"){totals.E+=0.5;totals.G+=0.5;}

  // ë™ì  íƒ€ì´ë¸Œë ˆì´ì»¤: Q2 > Q4 > Q3 > MBTI ë¯¸ì„¸ê°€ì¤‘ > ì•ŒíŒŒë²³
  const base = Object.keys(totals).reduce((m,k)=>{ m[k]=0; return m; },{});
  const applyPriority=(name, weight)=>{
    const sel=form.querySelector(`input[name="${name}"]:checked`);
    if(!sel) return;
    sel.value.split("").forEach(l=>{ base[l]+=weight; });
  };
  applyPriority('q2', 4);
  applyPriority('q4', 3);
  applyPriority('q3', 2);
  if(ei){ (ei==="E"?['F','B']:['A','C']).forEach(l=> base[l]+=0.4); }
  if(ns){ (ns==="N"?['D','E']:['G','H']).forEach(l=> base[l]+=0.4); }
  if(ft){ (ft==="F"?['B','C']:['A','D']).forEach(l=> base[l]+=0.4); }
  if(jp){ (jp==="J"?['F','H']:['E','G']).forEach(l=> base[l]+=0.4); }

  const ordered = Object.keys(totals).sort((a,b)=>{
    if(totals[b] !== totals[a]) return totals[b]-totals[a];
    if(base[b] !== base[a]) return base[b]-base[a];
    return a.localeCompare(b);
  });
  const top1=ordered[0], top2=ordered[1];
  return {top1, top2, totals};
}

function renderResult(){
  const {top1, top2} = computeResult();
  const T1=TYPES[top1], T2=TYPES[top2];

  // íƒ€ì´í‹€
  const key=pairKey(top1,top2);
  const comboTitle=COMBO_TITLES[key] || `${T1.ko}ì™€ ${T2.ko}ì˜ ì¡°í•©`;
  document.getElementById('combo-title').textContent=comboTitle;

  // MBTI ë¬¸êµ¬ + ì˜¨ë„
  const mbti=getMBTI();
  const mbtiMeta=MBTI_TEMP[mbti] || {line:"ì˜¤ëŠ˜ì˜ ì»¤í”¼ê°€ ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦´ ê±°ì˜ˆìš”.", temp:"hot"};
  document.getElementById('mbti-line').textContent=mbtiMeta.line;

  // ë°©ì‹/ì´ëª¨ì§€
  const methodKey=form.querySelector('input[name="method"]:checked')?.value||"M1";
  const methodEmoji=METHOD_EMOJI[methodKey];
  const tempEmoji = (methodKey==="M3") ? "â„ï¸" : (mbtiMeta.temp==="ice" ? "â„ï¸" : "ğŸ”¥");

  // ì´ëª¨ì§€ ë¼ì¸
  document.getElementById('emoji-line').textContent = `${T1.emoji}${T2.emoji}${tempEmoji}${methodEmoji}`;

  // ì›ë‘ ì¹´ë“œ
  const beanCards=document.getElementById('bean-cards');
  beanCards.innerHTML = `
    <div class="bean">
      <p class="bean-title"><span class="dot" style="background:${T1.color}"></span>${T1.ko} Â· ${T1.en}</p>
      <p class="bean-note">${T1.cup}</p>
    </div>
    <div class="bean">
      <p class="bean-title"><span class="dot" style="background:${T2.color}"></span>${T2.ko} Â· ${T2.en}</p>
      <p class="bean-note">${T2.cup}</p>
    </div>
  `;

  // ë°©ì‹ ê²°ê³¼
  document.getElementById('method-text').textContent = METHODS[methodKey].text;
}

/* ===== ëª¨ë‹¬ ì ‘ê·¼ì„±/UX ===== */
const resultEl = document.getElementById('result');
const firstBtn = document.getElementById('first');
const againBtn = document.getElementById('again');
const closeBtn = document.getElementById('close');
let lastFocused = null;

function lockScroll(lock){
  document.documentElement.style.overflow = lock ? 'hidden' : '';
  document.body.style.overflow = lock ? 'hidden' : '';
}

function showModal(){
  lastFocused = document.activeElement;
  resultEl.classList.add('show');
  lockScroll(true);
  (firstBtn || resultEl).focus({preventScroll:true});
  document.addEventListener('keydown', trapFocus);
}

function hideModal(){
  resultEl.classList.remove('show');
  lockScroll(false);
  document.removeEventListener('keydown', trapFocus);
  if(lastFocused && typeof lastFocused.focus==='function') lastFocused.focus();
}

function trapFocus(e){
  const focusables = resultEl.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
  if(e.key === 'Escape'){ hideModal(); return; }
  if(e.key !== 'Tab' || !focusables.length) return;
  const first = focusables[0];
  const last = focusables[focusables.length-1];
  if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
  else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
}

// ë°”ê¹¥ í´ë¦­ ë‹«ê¸°
resultEl.addEventListener('click', (e)=>{ if(e.target===resultEl) hideModal(); });

/* ===== ì´ë²¤íŠ¸ ë°”ì¸ë”© ===== */
submitBtn.addEventListener('click', ()=>{
  // í•„ìˆ˜ ì²´í¬(ì´ì¤‘ ì•ˆì „ë§)
  const requiredGroups = [
    ['mbti-ei','mbti-ns','mbti-ft','mbti-jp'],
    ['q2'],['q3'],['q4'],['method']
  ];
  const ok = requiredGroups.every(grp=>{
    if(grp.length>1){ return grp.every(n=> form.querySelector(`input[name="${n}"]:checked`)); }
    return !!form.querySelector(`input[name="${grp[0]}"]:checked`);
  });
  if(!ok){ alert('ëª¨ë“  ë¬¸í•­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

  renderResult();
  showModal();
});

document.getElementById('close').onclick=hideModal;
document.getElementById('again').onclick=()=>{ hideModal(); form.reset(); updateProgress(); };
document.getElementById('first').onclick=()=>{ hideModal(); form.reset(); updateProgress(); window.scrollTo({top:0,behavior:'smooth'}); };

/* ===== ì§„í–‰ë¥  ë‚´ë ˆì´ì…˜(ìŠ¤í¬ë¦°ë¦¬ë”) ===== */
const sr = document.createElement('span');
sr.id = 'progress-sr';
sr.className = 'sr-only';
document.body.appendChild(sr);
const _updateProgress = updateProgress;
updateProgress = function(){
  _updateProgress();
  const width = prog.style.width || '0%';
  sr.textContent = `ì§„í–‰ë¥  ${width}`;
};
</script>

<script>
// ===== ë°°ë„ˆ 6ì¥ "ì¤‘ë³µ ì—†ì´ ìˆœí™˜" (ì„¸ì…˜ ë‹¨ìœ„) =====
(function(){
  const imgEl = document.getElementById('bannerImg');
  if(!imgEl) return;

  const BANNERS = ['banner1.jpg','banner2.jpg','banner3.jpg','banner4.jpg','banner5.jpg','banner6.jpg'];

  // í”„ë¦¬ë¡œë“œ
  BANNERS.forEach(src => { const i = new Image(); i.src = src; });

  // ìœ í‹¸: ì„ê¸°
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  // ì €ì¥ëœ ìˆœì„œ/ì¸ë±ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
  let order = null;
  try { order = JSON.parse(sessionStorage.getItem('bannerOrder')||'null'); } catch(_){}
  let idx = parseInt(sessionStorage.getItem('bannerIndex')||'-1',10);

  // ì´ˆê¸° ìƒíƒœ: ìˆœì„œ ë§Œë“¤ê¸°
  if(!Array.isArray(order) || order.length !== BANNERS.length || order.some(x=>!BANNERS.includes(x))){
    order = shuffle(BANNERS);
    idx = -1;
  }

  // ë‹¤ìŒ ë°°ë„ˆ ì„ íƒ
  idx = (idx + 1) % order.length;
  const pick = order[idx];

  // í™”ë©´ í‘œì‹œ(í˜ì´ë“œ-ì¸ ì˜µì…˜)
  imgEl.classList.add('fade-in');
  imgEl.addEventListener('load', ()=> imgEl.classList.add('loaded'), { once:true });
  imgEl.src = pick;

  // alt ë¬¸êµ¬ ë§¤í•‘(ì„ íƒ)
  const altMap = {
    'banner1.jpg':'ë„¤,ì»¤í”¼ â€” í–‡ì‚´ ë“œëŠ” ë°” í…Œì´ë¸”',
    'banner2.jpg':'ë„¤,ì»¤í”¼ â€” ìš°ë“œí†¤ ë°”ë¦¬ìŠ¤íƒ€ ì¡´',
    'banner3.jpg':'ë„¤,ì»¤í”¼ â€” ë¼ë–¼ ì•„íŠ¸ê°€ ìˆëŠ” ì»µ',
    'banner4.jpg':'ë„¤,ì»¤í”¼ â€” ë“œë¦½ ì¥ë©´',
    'banner5.jpg':'ë„¤,ì»¤í”¼ â€” ì›ë‘ì™€ í•¸ë“œë°€',
    'banner6.jpg':'ë„¤,ì»¤í”¼ â€” ì „í¬ë™ ë§¤ì¥ ì „ê²½'
  };
  if (altMap[pick]) imgEl.alt = altMap[pick];

  // ë‹¤ìŒ ë¡œë“œë¥¼ ìœ„í•´ ìƒíƒœ ì €ì¥
  if(idx === order.length - 1){
    sessionStorage.setItem('bannerOrder', JSON.stringify(shuffle(BANNERS)));
    sessionStorage.setItem('bannerIndex', '-1');
  }else{
    sessionStorage.setItem('bannerOrder', JSON.stringify(order));
    sessionStorage.setItem('bannerIndex', String(idx));
  }
})();
</script>
</body>
</html>
